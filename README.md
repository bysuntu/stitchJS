# STL Boundary & Polyline Viewer

A browser-based 3D viewer for analyzing STL mesh files, detecting boundary edges, finding sharp corners, and tracing continuous polylines along boundaries.

## Features

- **STL File Loading**: Load and visualize STL mesh files directly in the browser
- **Boundary Detection**: Automatically detect open boundary edges in the mesh
- **Corner Detection**: Find sharp corners along boundaries with configurable angle threshold
- **Polyline Tracing**: Trace continuous polylines between corners
- **Interactive Visualization**:
  - Toggle visibility of mesh, boundaries, corners, and polylines
  - Customize colors for each element
  - View detailed statistics
  - Explore individual polylines
- **Real-time Processing**: All computation happens in the browser using VTK.js

## How It Works

### 1. Boundary Edge Detection
The algorithm identifies boundary edges by counting how many triangles share each edge:
- Edges shared by 2 triangles are internal (closed mesh)
- Edges shared by only 1 triangle are boundary edges (holes or open boundaries)

Uses a Cantor pairing hash function for efficient edge deduplication.

### 2. Corner Detection
Detects sharp corners on boundaries by:
- Finding boundary points with exactly 2 neighbors
- Calculating the angle between the two adjacent edges
- Marking points with angles below the threshold as corners

### 3. Polyline Tracing
Traces continuous polylines between corners by:
- Starting from each corner
- Following boundary edges until reaching another corner
- Avoiding duplicate traversal of edges
- Computing total euclidean length

## Usage

### Quick Start (Recommended)

The project now uses **VTK.js installed locally via npm** for better reliability and performance.

#### 1. Install Dependencies
```bash
npm install
```

#### 2. Run Development Server
```bash
npm run dev
```

Or simply double-click `start-dev.bat` on Windows. The app will automatically open at `http://localhost:8080`

#### 3. Build for Production
```bash
npm run build
```

This creates optimized files in the `dist/` folder that you can deploy to any web server.

### Alternative: Using the Built Files

After running `npm run build`, you can serve the `dist/` folder:

```bash
# Using Python 3
cd dist
python -m http.server 8000

# Using Node.js
npx http-server dist

# Using PHP
cd dist
php -S localhost:8000
```

Then navigate to `http://localhost:8000` in your browser.

### How to Use the App

1. Click "Choose STL File" and select your STL file (or use the included `test.stl`)
2. Adjust the corner angle threshold if needed (default: 30°)
3. Click "Process STL" to detect boundaries and polylines
4. Use the visibility toggles and color pickers to customize the view

## Controls

### Detection Settings
- **Corner Angle Threshold**: Adjust sensitivity for corner detection (5° - 90°)
  - Lower values detect sharper corners only
  - Higher values detect more gradual corners

### Visibility Toggles
- **Show Mesh**: Display the original 3D mesh (semi-transparent)
- **Show Boundary Edges**: Display detected boundary edges (red)
- **Show Corners**: Display detected corners as spheres (green)
- **Show Polylines**: Display traced polylines (cyan)

### Colors
Customize the color of each visual element using color pickers.

### Statistics
View real-time statistics:
- Number of vertices
- Number of triangles
- Number of boundary edges
- Number of corners
- Number of polylines

### Polyline List
Browse all detected polylines sorted by length:
- Number of points in each polyline
- Total euclidean length

## File Structure

```
stlStitch/
├── src/
│   ├── index.html     # Main HTML template with UI
│   ├── index.js       # Application entry point with VTK.js imports
│   └── ops.js         # Core algorithms (boundary detection, corner finding, polyline tracing)
├── dist/              # Built files (generated by webpack)
│   ├── index.html     # Processed HTML
│   ├── bundle.js      # Bundled JavaScript with VTK.js
│   └── test.stl       # Copied test file
├── node_modules/      # npm dependencies (including @kitware/vtk.js)
├── package.json       # Project configuration and dependencies
├── webpack.config.js  # Webpack bundler configuration
├── start-dev.bat      # Windows batch file to start dev server
├── ops.jsx            # Original algorithm implementations (reference)
├── stitch.jsx         # Original usage examples (reference)
├── test.stl           # Sample STL file for testing
└── README.md          # This file
```

## Technical Details

### Dependencies
- **@kitware/vtk.js** v29.5.0 - 3D rendering and STL parsing (installed via npm)
- **webpack** v5.89.0 - Module bundler
- **webpack-dev-server** v4.15.1 - Development server with hot reload

### Browser Requirements
- Modern browser with WebGL support
- JavaScript enabled
- Recommended: Chrome, Firefox, Edge, or Safari (latest versions)

### NPM Scripts
- `npm run dev` - Start development server at http://localhost:8080 (with hot reload)
- `npm run build` - Build optimized production bundle to `dist/` folder
- `npm start` - Start production server (requires separate server.js implementation)

### Performance
- Optimized for meshes with up to 100K triangles
- All processing is done client-side (no server required)
- Uses efficient data structures (Map, Set) for adjacency lookups

## Algorithms

### Edge Hashing
Uses Cantor pairing function for unique edge identification:
```javascript
hash(a, b) = a >= b ? a * a + a + b : b * b + a
```

### Adjacency Map
Builds a Map<pointId, Set<neighborIds>> for O(1) neighbor lookups during corner detection and polyline tracing.

### Polyline Tracing
- Uses edge visit tracking to avoid duplicate traversal
- Traces from each corner in both directions
- Stops when hitting another corner or dead end
- Computes both point count and euclidean length

## Use Cases

- **Mesh Repair**: Identify holes and open boundaries in 3D models
- **Quality Inspection**: Verify mesh closure and detect defects
- **Path Planning**: Extract boundary contours for toolpath generation
- **3D Printing**: Validate model integrity before printing
- **CAD Analysis**: Analyze boundary curves of complex geometry

## Example Test File

The included `test.stl` file demonstrates:
- Multiple boundary edges
- Sharp corners at various angles
- Continuous polylines along boundaries

## Troubleshooting

**File won't load:**
- Ensure the file is a valid STL (ASCII or binary format)
- Check browser console for error messages

**No boundaries detected:**
- The mesh may be completely closed (no holes)
- Try a different STL file with known boundaries

**Performance issues:**
- Large meshes (>100K triangles) may take longer to process
- Consider simplifying the mesh in external software first

**Visualization looks wrong:**
- Try adjusting the angle threshold
- Toggle different visibility options
- Reset camera by reloading the page

## License

This project is provided as-is for educational and commercial use.

## Credits

Built with:
- VTK.js for 3D visualization
- Modern JavaScript (ES6+)
- Custom algorithms for boundary detection and polyline tracing
